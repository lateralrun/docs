# Integration: Backend

Once you've integrated Lateral.run into your frontend, the next step is running
your customer's code from your backend.

## Node.js

If your backend is written in Node.js, we offer a
[Node.js client](https://github.com/lateralrun/node) that handles the underlying
plumbing for you. See the project's docs for more thorough examples and
explanations, but here's a quick peek:

```js
const Lateral = require('lateralrun')

const lateral = new Lateral({
  appID: '{{YOUR_APP_ID}}',
  appSecret: '{{YOUR_APP_SECRET}}',
})

lateral.run({
  account: 12345,
  event: 'contacts.new',
  data: {
    id: 67890,
    name: 'A New Record',
    created_at: '2019-12-30T02:51:49.803Z',
  },
})
```

## REST API

If your backend is written in something other than Node.js, you can integrate
directly with our REST API.

Here's an example using [curl](https://curl.haxx.se/), with explanations to
follow:

```bash
$ curl \
  -X POST \
  -H 'Authorization: Bearer {{TOKEN}}' \
  -H 'Content-Type: application/json' \
  -d '{ "id": 67890 }' \
  https://app.lateral.run/api/cloud_functions/by_event/{{EVENT}}/run?async=true
```

- `{{TOKEN}}` can be generated by following the instructions in
  [Authentication](/docs/authentication.md).
- The JSON payload (`-d`) is the data to pass to your customer's code.
- `{{EVENT}}` is the identifier you chose when creating the event, such as
  `contacts.new`.
- `async` is an optional query string param that defaults to `true`. Set it to
  `false` or `0` to run your customer's code synchronously.

### Success

If the run request succeeds, an `operation` object is returned:

```js
{
  "operation": {
    "id": "0acd3a94-5763-47a8-8493-7a33c037f6ed",
    "type": "cloud_functions.run",
    "status": "WAITING",
    "resource_type": "CloudFunction",
    "resource_id": "046def28-5158-43be-9868-04f963bb4dcd",
    "created_at": "2020-04-06T10:19:10.246Z",
    "updated_at": "2020-04-06T10:19:10.246Z",
    "completed_at": null,
    "data": {
      "id": 67890
    },
    "result": null
  }
}
```

This example shows an asynchronous run request, denoted by `status: 'WAITING'`,
`completed_at: null`, and `result: null`.

Synchronous run requests return with a `status` of `SUCCESS` or `ERROR`
(depending on the outcome of running your customer's code), an ISO 8601
`completed_at` date, and a `result` that corresponds with the `status`. For
example:

```js
{
  "operation": {
    ...
    "status": "SUCCESS",
    "result": {
      "response": {
        "qs": "id=67890",
        "separator": "&"
      },
      "logs": [
        {
          "date": "2020-04-06T10:25:01.702Z",
          "severity": "INFO",
          "message": "Processing: 67890"
        }
      ]
    }
  }
}
```

Or, when your customer's code throws an error:

```js
{
  "operation": {
    ...
    "status": "ERROR",
    "result": {
      "error": {
        "name": "Error",
        "stack": "Error: Whoops\n    at code (/var/task/index.js:9:7)\n    at Runtime.exports.lateral [as handler] (/var/task/index.js:33:29)\n    at Runtime.handleOnce (/var/runtime/Runtime.js:66:25)",
        "message": "Whoops"
      },
      "logs": [...]
    }
  }
}
```

### Error

If the run request fails, an appropriate status code is returned with one or
more errors explaining why:

```js
{
  "errors": [
    "status": 401,
    "title": "Unauthorized",
    "message": "Token expired"
  ]
}
```

_Note: This is not to be confused with your customer's code throwing an error,
which is still considered a successful run request (see above). This type of
error is thrown by the Lateral.run service itself._
